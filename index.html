<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulateur d'√©ligibilit√© Kap TPE</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #001f3f;
      color: #fff;
      margin: 0;
      padding: 2rem;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 600px;
      width: 100%;
      padding: 1rem;
      background-color: #002b5c;
      border-radius: 8px;
    }
    h1 {
      color: #FFD700;
      font-size: 2rem;
    }
    p {
      font-size: 1rem;
      color: #ccc;
    }
    label {
      display: block;
      margin: 1rem 0 0.5rem;
    }
    input, select {
      width: 100%;
      padding: 0.5rem;
      border-radius: 4px;
      border: none;
      font-size: 1rem;
    }
    button {
      margin-top: 1.5rem;
      padding: 0.75rem 1.5rem;
      background-color: #FFD700;
      color: #000;
      border: none;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
    }
    #result {
      margin-top: 2rem;
      padding: 1rem;
      background-color: #2f2f2f;
      border-radius: 8px;
    }
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Simulateur d'√©ligibilit√© Kap TPE</h1>
    <p>Veuillez remplir les champs ci-dessous selon les crit√®res de l'aide. Exemple de code APE : <strong>7420ZS</strong><br>
    La liste des codes APE √©ligibles est consultable sur le site officiel :
    <a href="https://data.artisanat.fr/nafa/" target="_blank" style="color: #FFD700; text-decoration: underline;">https://data.artisanat.fr/nafa/</a></p>

    <label for="ape">Code APE :</label>
    <input type="text" id="ape" placeholder="7420ZS" />

    <label for="ca">Chiffre d'affaires (en ‚Ç¨) :</label>
    <input type="number" id="ca" placeholder="ex : 850000" />

    <label for="salaries">Nombre de salari√©s :</label>
    <input type="number" id="salaries" placeholder="ex : 3" />

    <label for="montant">Montant du projet (HT en ‚Ç¨) :</label>
    <input type="number" id="montant" placeholder="ex : 12000" />

    <label for="zone">√ätes-vous situ√© dans les Hauts ?</label>
    <select id="zone">
      <option value="non">Non</option>
      <option value="oui">Oui</option>
    </select>

    <button onclick="verifierEligibilite()">V√©rifier l'√©ligibilit√©</button>

    <div id="result"></div>
  </div>

  <script>
    let codesAPEEligibles = [];

    fetch("codes-ape.json")
      .then(response => response.json())
      .then(data => {
        codesAPEEligibles = data.codes.map(code => code.toUpperCase());
      })
      .catch(err => {
        console.error("Erreur de chargement du fichier JSON :", err);
      });

    function verifierEligibilite() {
      const ape = document.getElementById("ape").value.toUpperCase().trim();
      const ca = parseInt(document.getElementById("ca").value);
      const salaries = parseInt(document.getElementById("salaries").value);
      const montant = parseInt(document.getElementById("montant").value);
      const zone = document.getElementById("zone").value;
      const result = document.getElementById("result");

      let message = "";
      let errors = [];

      if (!ape || isNaN(ca) || isNaN(salaries) || isNaN(montant)) {
        result.innerHTML = "<strong>Erreur :</strong> Veuillez remplir tous les champs avant de v√©rifier l'√©ligibilit√©.";
        result.style.color = "#ff6b6b";
        return;
      }

      if (!codesAPEEligibles.includes(ape)) {
        errors.push("Votre code APE n'est pas r√©f√©renc√© comme √©ligible.");
      }
      if (ca > 1000000) {
        errors.push("Votre chiffre d'affaires d√©passe le plafond de 1‚ÄØ000‚ÄØ000 ‚Ç¨.");
      }
      if (salaries > 10) {
        errors.push("L'entreprise ne doit pas d√©passer 10 salari√©s.");
      }
      if (montant < 5001 || montant > 19999) {
        errors.push("Le montant du projet doit √™tre compris entre 5‚ÄØ001 ‚Ç¨ et 19‚ÄØ999 ‚Ç¨ HT.");
      }

      if (errors.length > 0) {
        message = "<strong>R√©sultat :</strong><br><ul><li>" + errors.join("</li><li>") + "</li></ul>";
        result.style.color = "#FFD700";
      } else {
        const taux = zone === "oui" ? 0.6 : 0.5;
        const aide = Math.round(montant * taux);
        const reste = montant - aide;

        message = `<strong>F√©licitations üéâ</strong><br>
        Votre projet semble √©ligible √† l'aide Kap TPE.<br>
        Taux de subvention : ${taux * 100}%<br>
        Montant estim√© de l'aide : ${aide.toLocaleString()} ‚Ç¨<br>
        Reste √† charge estim√© : ${reste.toLocaleString()} ‚Ç¨.<br>
        N'h√©sitez pas √† nous contacter pour monter le dossier.`;
        result.style.color = "#00e676";
      }

      result.innerHTML = message;
    }
  </script>
</body>
</html>
